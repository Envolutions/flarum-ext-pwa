{"version":3,"file":"forum.js","mappings":"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","sources":["webpack://@askvortsov/flarum-pwa/webpack/bootstrap","webpack://@askvortsov/flarum-pwa/webpack/runtime/compat get default export","webpack://@askvortsov/flarum-pwa/webpack/runtime/define property getters","webpack://@askvortsov/flarum-pwa/webpack/runtime/hasOwnProperty shorthand","webpack://@askvortsov/flarum-pwa/external root \"flarum.reg.get('core', 'common/extend')\"","webpack://@askvortsov/flarum-pwa/./node_modules/idb/build/esm/wrap-idb-value.js","webpack://@askvortsov/flarum-pwa/./node_modules/idb/build/esm/index.js","webpack://@askvortsov/flarum-pwa/external root \"flarum.reg.get('core', 'common/components/Page')\"","webpack://@askvortsov/flarum-pwa/external root \"flarum.reg.get('core', 'common/components/LinkButton')\"","webpack://@askvortsov/flarum-pwa/external root \"flarum.reg.get('core', 'forum/components/SessionDropdown')\"","webpack://@askvortsov/flarum-pwa/external root \"flarum.reg.get('core', 'common/utils/extractText')\"","webpack://@askvortsov/flarum-pwa/external root \"flarum.reg.get('core', 'forum/utils/DiscussionControls')\"","webpack://@askvortsov/flarum-pwa/external root \"flarum.reg.get('core', 'forum/utils/PostControls')\"","webpack://@askvortsov/flarum-pwa/external root \"flarum.reg.get('core', 'forum/utils/UserControls')\"","webpack://@askvortsov/flarum-pwa/external root \"flarum.reg.get('core', 'common/components/Button')\"","webpack://@askvortsov/flarum-pwa/./src/forum/addShareButtons.js","webpack://@askvortsov/flarum-pwa/external root \"flarum.reg.get('core', 'common/components/Alert')\"","webpack://@askvortsov/flarum-pwa/external root \"flarum.reg.get('core', 'common/components/Link')\"","webpack://@askvortsov/flarum-pwa/external root \"flarum.reg.get('core', 'common/components/Icon')\"","webpack://@askvortsov/flarum-pwa/./src/forum/use-pwa-builder.js","webpack://@askvortsov/flarum-pwa/./src/forum/addPushNotifications.js","webpack://@askvortsov/flarum-pwa/./src/forum/index.js"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.reg.get('core', 'common/extend');","const instanceOfAny = (object, constructors) => constructors.some((c) => object instanceof c);\n\nlet idbProxyableTypes;\nlet cursorAdvanceMethods;\n// This is a function to prevent it throwing up in node environments.\nfunction getIdbProxyableTypes() {\n    return (idbProxyableTypes ||\n        (idbProxyableTypes = [\n            IDBDatabase,\n            IDBObjectStore,\n            IDBIndex,\n            IDBCursor,\n            IDBTransaction,\n        ]));\n}\n// This is a function to prevent it throwing up in node environments.\nfunction getCursorAdvanceMethods() {\n    return (cursorAdvanceMethods ||\n        (cursorAdvanceMethods = [\n            IDBCursor.prototype.advance,\n            IDBCursor.prototype.continue,\n            IDBCursor.prototype.continuePrimaryKey,\n        ]));\n}\nconst cursorRequestMap = new WeakMap();\nconst transactionDoneMap = new WeakMap();\nconst transactionStoreNamesMap = new WeakMap();\nconst transformCache = new WeakMap();\nconst reverseTransformCache = new WeakMap();\nfunction promisifyRequest(request) {\n    const promise = new Promise((resolve, reject) => {\n        const unlisten = () => {\n            request.removeEventListener('success', success);\n            request.removeEventListener('error', error);\n        };\n        const success = () => {\n            resolve(wrap(request.result));\n            unlisten();\n        };\n        const error = () => {\n            reject(request.error);\n            unlisten();\n        };\n        request.addEventListener('success', success);\n        request.addEventListener('error', error);\n    });\n    promise\n        .then((value) => {\n        // Since cursoring reuses the IDBRequest (*sigh*), we cache it for later retrieval\n        // (see wrapFunction).\n        if (value instanceof IDBCursor) {\n            cursorRequestMap.set(value, request);\n        }\n        // Catching to avoid \"Uncaught Promise exceptions\"\n    })\n        .catch(() => { });\n    // This mapping exists in reverseTransformCache but doesn't doesn't exist in transformCache. This\n    // is because we create many promises from a single IDBRequest.\n    reverseTransformCache.set(promise, request);\n    return promise;\n}\nfunction cacheDonePromiseForTransaction(tx) {\n    // Early bail if we've already created a done promise for this transaction.\n    if (transactionDoneMap.has(tx))\n        return;\n    const done = new Promise((resolve, reject) => {\n        const unlisten = () => {\n            tx.removeEventListener('complete', complete);\n            tx.removeEventListener('error', error);\n            tx.removeEventListener('abort', error);\n        };\n        const complete = () => {\n            resolve();\n            unlisten();\n        };\n        const error = () => {\n            reject(tx.error || new DOMException('AbortError', 'AbortError'));\n            unlisten();\n        };\n        tx.addEventListener('complete', complete);\n        tx.addEventListener('error', error);\n        tx.addEventListener('abort', error);\n    });\n    // Cache it for later retrieval.\n    transactionDoneMap.set(tx, done);\n}\nlet idbProxyTraps = {\n    get(target, prop, receiver) {\n        if (target instanceof IDBTransaction) {\n            // Special handling for transaction.done.\n            if (prop === 'done')\n                return transactionDoneMap.get(target);\n            // Polyfill for objectStoreNames because of Edge.\n            if (prop === 'objectStoreNames') {\n                return target.objectStoreNames || transactionStoreNamesMap.get(target);\n            }\n            // Make tx.store return the only store in the transaction, or undefined if there are many.\n            if (prop === 'store') {\n                return receiver.objectStoreNames[1]\n                    ? undefined\n                    : receiver.objectStore(receiver.objectStoreNames[0]);\n            }\n        }\n        // Else transform whatever we get back.\n        return wrap(target[prop]);\n    },\n    set(target, prop, value) {\n        target[prop] = value;\n        return true;\n    },\n    has(target, prop) {\n        if (target instanceof IDBTransaction &&\n            (prop === 'done' || prop === 'store')) {\n            return true;\n        }\n        return prop in target;\n    },\n};\nfunction replaceTraps(callback) {\n    idbProxyTraps = callback(idbProxyTraps);\n}\nfunction wrapFunction(func) {\n    // Due to expected object equality (which is enforced by the caching in `wrap`), we\n    // only create one new func per func.\n    // Edge doesn't support objectStoreNames (booo), so we polyfill it here.\n    if (func === IDBDatabase.prototype.transaction &&\n        !('objectStoreNames' in IDBTransaction.prototype)) {\n        return function (storeNames, ...args) {\n            const tx = func.call(unwrap(this), storeNames, ...args);\n            transactionStoreNamesMap.set(tx, storeNames.sort ? storeNames.sort() : [storeNames]);\n            return wrap(tx);\n        };\n    }\n    // Cursor methods are special, as the behaviour is a little more different to standard IDB. In\n    // IDB, you advance the cursor and wait for a new 'success' on the IDBRequest that gave you the\n    // cursor. It's kinda like a promise that can resolve with many values. That doesn't make sense\n    // with real promises, so each advance methods returns a new promise for the cursor object, or\n    // undefined if the end of the cursor has been reached.\n    if (getCursorAdvanceMethods().includes(func)) {\n        return function (...args) {\n            // Calling the original function with the proxy as 'this' causes ILLEGAL INVOCATION, so we use\n            // the original object.\n            func.apply(unwrap(this), args);\n            return wrap(cursorRequestMap.get(this));\n        };\n    }\n    return function (...args) {\n        // Calling the original function with the proxy as 'this' causes ILLEGAL INVOCATION, so we use\n        // the original object.\n        return wrap(func.apply(unwrap(this), args));\n    };\n}\nfunction transformCachableValue(value) {\n    if (typeof value === 'function')\n        return wrapFunction(value);\n    // This doesn't return, it just creates a 'done' promise for the transaction,\n    // which is later returned for transaction.done (see idbObjectHandler).\n    if (value instanceof IDBTransaction)\n        cacheDonePromiseForTransaction(value);\n    if (instanceOfAny(value, getIdbProxyableTypes()))\n        return new Proxy(value, idbProxyTraps);\n    // Return the same value back if we're not going to transform it.\n    return value;\n}\nfunction wrap(value) {\n    // We sometimes generate multiple promises from a single IDBRequest (eg when cursoring), because\n    // IDB is weird and a single IDBRequest can yield many responses, so these can't be cached.\n    if (value instanceof IDBRequest)\n        return promisifyRequest(value);\n    // If we've already transformed this value before, reuse the transformed value.\n    // This is faster, but it also provides object equality.\n    if (transformCache.has(value))\n        return transformCache.get(value);\n    const newValue = transformCachableValue(value);\n    // Not all types are transformed.\n    // These may be primitive types, so they can't be WeakMap keys.\n    if (newValue !== value) {\n        transformCache.set(value, newValue);\n        reverseTransformCache.set(newValue, value);\n    }\n    return newValue;\n}\nconst unwrap = (value) => reverseTransformCache.get(value);\n\nexport { reverseTransformCache as a, instanceOfAny as i, replaceTraps as r, unwrap as u, wrap as w };\n","import { w as wrap, r as replaceTraps } from './wrap-idb-value.js';\nexport { u as unwrap, w as wrap } from './wrap-idb-value.js';\n\n/**\n * Open a database.\n *\n * @param name Name of the database.\n * @param version Schema version.\n * @param callbacks Additional callbacks.\n */\nfunction openDB(name, version, { blocked, upgrade, blocking, terminated } = {}) {\n    const request = indexedDB.open(name, version);\n    const openPromise = wrap(request);\n    if (upgrade) {\n        request.addEventListener('upgradeneeded', (event) => {\n            upgrade(wrap(request.result), event.oldVersion, event.newVersion, wrap(request.transaction));\n        });\n    }\n    if (blocked)\n        request.addEventListener('blocked', () => blocked());\n    openPromise\n        .then((db) => {\n        if (terminated)\n            db.addEventListener('close', () => terminated());\n        if (blocking)\n            db.addEventListener('versionchange', () => blocking());\n    })\n        .catch(() => { });\n    return openPromise;\n}\n/**\n * Delete a database.\n *\n * @param name Name of the database.\n */\nfunction deleteDB(name, { blocked } = {}) {\n    const request = indexedDB.deleteDatabase(name);\n    if (blocked)\n        request.addEventListener('blocked', () => blocked());\n    return wrap(request).then(() => undefined);\n}\n\nconst readMethods = ['get', 'getKey', 'getAll', 'getAllKeys', 'count'];\nconst writeMethods = ['put', 'add', 'delete', 'clear'];\nconst cachedMethods = new Map();\nfunction getMethod(target, prop) {\n    if (!(target instanceof IDBDatabase &&\n        !(prop in target) &&\n        typeof prop === 'string')) {\n        return;\n    }\n    if (cachedMethods.get(prop))\n        return cachedMethods.get(prop);\n    const targetFuncName = prop.replace(/FromIndex$/, '');\n    const useIndex = prop !== targetFuncName;\n    const isWrite = writeMethods.includes(targetFuncName);\n    if (\n    // Bail if the target doesn't exist on the target. Eg, getAll isn't in Edge.\n    !(targetFuncName in (useIndex ? IDBIndex : IDBObjectStore).prototype) ||\n        !(isWrite || readMethods.includes(targetFuncName))) {\n        return;\n    }\n    const method = async function (storeName, ...args) {\n        // isWrite ? 'readwrite' : undefined gzipps better, but fails in Edge :(\n        const tx = this.transaction(storeName, isWrite ? 'readwrite' : 'readonly');\n        let target = tx.store;\n        if (useIndex)\n            target = target.index(args.shift());\n        const returnVal = await target[targetFuncName](...args);\n        if (isWrite)\n            await tx.done;\n        return returnVal;\n    };\n    cachedMethods.set(prop, method);\n    return method;\n}\nreplaceTraps((oldTraps) => ({\n    ...oldTraps,\n    get: (target, prop, receiver) => getMethod(target, prop) || oldTraps.get(target, prop, receiver),\n    has: (target, prop) => !!getMethod(target, prop) || oldTraps.has(target, prop),\n}));\n\nexport { deleteDB, openDB };\n","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.reg.get('core', 'common/components/Page');","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.reg.get('core', 'common/components/LinkButton');","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.reg.get('core', 'forum/components/SessionDropdown');","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.reg.get('core', 'common/utils/extractText');","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.reg.get('core', 'forum/utils/DiscussionControls');","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.reg.get('core', 'forum/utils/PostControls');","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.reg.get('core', 'forum/utils/UserControls');","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.reg.get('core', 'common/components/Button');","import { extend } from 'flarum/common/extend';\nimport extractText from 'flarum/common/utils/extractText';\nimport DiscussionControls from 'flarum/forum/utils/DiscussionControls';\nimport PostControls from 'flarum/forum/utils/PostControls';\nimport UserControls from 'flarum/forum/utils/UserControls';\nimport Button from 'flarum/common/components/Button';\nasync function shareContent(data) {\n  try {\n    const title = extractText(data.title);\n    await navigator.share({\n      title,\n      url: data.url\n    });\n    resultPara.textContent = 'MDN shared successfully';\n  } catch (err) {\n    console.log('Error: ' + err);\n  }\n}\nexport default () => {\n  extend(DiscussionControls, 'userControls', function (items, discussion) {\n    if (!navigator.share) return;\n    items.add('share', Button.component({\n      icon: 'fas fa-share-square',\n      onclick: () => shareContent({\n        title: discussion.title(),\n        url: window.location.protocol + '//' + window.location.hostname + app.route.discussion(discussion)\n      })\n    }, app.translator.trans('askvortsov-pwa.forum.discussion_controls.share_button')), -1);\n  });\n  extend(PostControls, 'userControls', function (items, post) {\n    if (!navigator.share) return;\n    items.add('share', Button.component({\n      icon: 'fas fa-share-square',\n      onclick: () => shareContent({\n        title: app.translator.trans('askvortsov-pwa.forum.post_controls.share_api.title', {\n          username: post.user().displayName(),\n          title: post.discussion().title()\n        }),\n        url: window.location.protocol + '//' + window.location.hostname + app.route.post(post)\n      })\n    }, app.translator.trans('askvortsov-pwa.forum.post_controls.share_button')), 100);\n  });\n  extend(UserControls, 'userControls', function (items, user) {\n    if (!navigator.share) return;\n    items.add('share', Button.component({\n      icon: 'fas fa-share-square',\n      onclick: () => shareContent({\n        title: user.displayName(),\n        url: window.location.protocol + '//' + window.location.hostname + app.route.user(user)\n      })\n    }, app.translator.trans('askvortsov-pwa.forum.user_controls.share_button')), 100);\n  });\n};","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.reg.get('core', 'common/components/Alert');","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.reg.get('core', 'common/components/Link');","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.reg.get('core', 'common/components/Icon');","/**\n * Triggered when the push token is generated by the device.\n */\nexport const PushToken = 'push-token';\n\n/**\n * Triggered when the user requests permission on the push event.\n */\nexport const PushPermissionRequest = 'push-permission-request';\n\n/**\n * Returns the state of the push request of the device.\n */\nexport const PushPermissionState = 'push-permission-state';\n\n/**\n * Check if the client is a webview in an iOS or iPadOS device.\n * @returns {boolean}\n */\nexport const usingAppleWebview = () => window.webkit && window.webkit.messageHandlers;\nexport const requestPushPermissionState = () => window.webkit.messageHandlers[PushPermissionState].postMessage(PushPermissionState);\nexport const requestPushPermissions = () => window.webkit.messageHandlers[PushPermissionRequest].postMessage(PushPermissionRequest);\nexport const requestPushToken = () => window.webkit.messageHandlers[PushToken].postMessage(PushToken);\nexport const usePWABuilder = () => {\n  /**\n   * @type {'notDetermined' | 'denied' | 'authorized' | 'ephemeral' | 'provisional' | 'unknown' | 'granted'}\n   */\n  let permissionState = 'granted';\n  const handlePushPermissionRequest = event => {\n    if (event.detail !== 'granted') {\n      return;\n    }\n    permissionState = 'granted';\n    requestPushToken();\n  };\n  const handlePushToken = event => {\n    app.request({\n      method: 'POST',\n      url: app.forum.attribute('apiUrl') + '/pwa/firebase-push-subscriptions',\n      body: {\n        token: event.detail\n      }\n    });\n  };\n  const handlePushPermissionState = event => {\n    permissionState = event.detail;\n    m.redraw();\n  };\n\n  /**\n   * @param {'notDetermined' | 'denied' | 'authorized' | 'ephemeral' | 'provisional' | 'unknown' | 'granted'} state\n   *\n   * @returns {boolean}\n   */\n  const hasFirebasePushState = state => state === permissionState;\n  function registerFirebasePushNotificationListeners() {\n    if (!usingAppleWebview()) {\n      return;\n    }\n    requestPushPermissionState();\n    window.addEventListener(PushPermissionRequest, handlePushPermissionRequest);\n    window.addEventListener(PushPermissionState, handlePushPermissionState);\n    window.addEventListener(PushToken, handlePushToken);\n  }\n  function removeFirebasePushNotificationListeners() {\n    if (!usingAppleWebview()) {\n      return;\n    }\n    window.removeEventListener(PushPermissionRequest, handlePushPermissionRequest);\n    window.removeEventListener(PushPermissionState, handlePushPermissionState);\n    window.removeEventListener(PushToken, handlePushToken);\n  }\n  return {\n    hasFirebasePushState,\n    registerFirebasePushNotificationListeners,\n    removeFirebasePushNotificationListeners\n  };\n};","import { extend } from 'flarum/common/extend';\nimport Alert from 'flarum/common/components/Alert';\nimport Button from 'flarum/common/components/Button';\nimport Link from 'flarum/common/components/Link';\nimport Page from 'flarum/common/components/Page';\nimport Icon from 'flarum/common/components/Icon';\nimport { usingAppleWebview, requestPushPermissions, requestPushPermissionState, requestPushToken, usePWABuilder } from './use-pwa-builder';\nconst subscribeUser = save => {\n  return app.sw.pushManager.subscribe({\n    userVisibleOnly: true,\n    applicationServerKey: app.forum.attribute('vapidPublicKey')\n  }).then(subscription => {\n    if (!save) return;\n    app.request({\n      method: 'POST',\n      url: app.forum.attribute('apiUrl') + '/pwa/push',\n      body: {\n        subscription\n      }\n    });\n  });\n};\nconst pushEnabled = () => {\n  if (!app.session.user) return false;\n  const obj = app.session.user.preferences();\n  let key;\n  for (key in obj) {\n    if ((typeof key === 'string' || key instanceof String) && key.startsWith('notify_') && key.endsWith('_push') && obj[key]) {\n      return true;\n    }\n  }\n  return false;\n};\nconst supportsBrowserNotifications = () => 'Notification' in window;\nexport const refreshSubscription = async sw => {\n  if (!app.cache.pwaRefreshed && 'Notification' in window && window.Notification.permission === 'granted' && pushEnabled()) try {\n    await subscribeUser(true);\n  } catch (e) {\n    if (!sw.pushManager) {\n      return;\n    }\n    sw.pushManager.getSubscription().then(s => s.unsubscribe().then(subscribeUser.bind(this, true)));\n  }\n  app.cache.pwaRefreshed = true;\n};\nconst pushConfigured = () => {\n  return app.forum.attribute('vapidPublicKey');\n};\nlet {\n  registerFirebasePushNotificationListeners,\n  removeFirebasePushNotificationListeners,\n  firebasePushNotificationState,\n  hasFirebasePushState\n} = usePWABuilder();\nexport default () => {\n  extend(Page.prototype, 'oncreate', () => {\n    if (!pushConfigured()) return;\n    const dismissAlert = () => {\n      localStorage.setItem('askvortov-pwa.notif-alert.dismissed', JSON.stringify({\n        timestamp: new Date().getTime()\n      }));\n    };\n    app.alerts.dismiss(app.cache.pwaNotifsAlert);\n    if (!localStorage.getItem('askvortov-pwa.notif-alert.dismissed') && 'Notification' in window && window.Notification.permission === 'default' && pushEnabled()) {\n      app.cache.pwaNotifsAlert = app.alerts.show({\n        controls: [m(Link, {\n          class: \"Button Button--link\",\n          href: app.route('settings'),\n          onclick: () => dismissAlert()\n        }, app.translator.trans('askvortsov-pwa.forum.alerts.optin_button'))],\n        ondismiss: dismissAlert\n      }, app.translator.trans('askvortsov-pwa.forum.alerts.optin'));\n    }\n  });\n  extend('flarum/forum/components/NotificationGrid', 'notificationMethods', function (items) {\n    if (!pushConfigured()) return;\n    items.add('push', {\n      name: 'push',\n      icon: 'fas fa-mobile',\n      label: app.translator.trans('askvortsov-pwa.forum.settings.push_header')\n    });\n  });\n  extend('flarum/forum/components/SettingsPage', 'notificationsItems', function (items) {\n    if (usingAppleWebview()) return;\n    if (!pushConfigured()) return;\n    if (!supportsBrowserNotifications()) {\n      items.add('push-no-browser-support', Alert.component({\n        dismissible: false,\n        controls: [m(\"a\", {\n          class: \"Button Button--link\",\n          href: \"https://developer.mozilla.org/en-US/docs/Web/API/Push_API\"\n        }, app.translator.trans('askvortsov-pwa.forum.settings.pwa_notifications.no_browser_support_button'))]\n      }, [m(Icon, {\n        name: \"fas fa-exclamation-triangle\"\n      }), app.translator.trans('askvortsov-pwa.forum.settings.pwa_notifications.no_browser_support')]), 10);\n      return;\n    }\n    if (window.Notification.permission === 'default') {\n      if (!pushConfigured()) return;\n      items.add('push-optin-default', Alert.component({\n        itemClassName: 'pwa-setting-alert',\n        dismissible: false,\n        controls: [Button.component({\n          className: 'Button Button--link',\n          onclick: () => {\n            window.Notification.requestPermission(res => {\n              m.redraw();\n              if (res === 'granted') {\n                subscribeUser(true);\n              }\n            });\n          }\n        }, app.translator.trans('askvortsov-pwa.forum.settings.pwa_notifications.access_default_button'))]\n      }, [m(Icon, {\n        name: \"fas fa-exclamation-circle\"\n      }), app.translator.trans('askvortsov-pwa.forum.settings.pwa_notifications.access_default')]), 10);\n    } else if (window.Notification.permission === 'denied') {\n      items.add('push-optin-denied', Alert.component({\n        itemClassName: 'pwa-setting-alert',\n        dismissible: false,\n        type: 'error',\n        controls: [m(\"a\", {\n          class: \"Button Button--link\",\n          href: \"https://support.humblebundle.com/hc/en-us/articles/360008513933-Enabling-and-Disabling-Browser-Notifications-in-Various-Browsers\"\n        }, app.translator.trans('askvortsov-pwa.forum.settings.pwa_notifications.access_denied_button'))]\n      }, [m(Icon, {\n        name: \"fas fa-exclamation-triangle\"\n      }), app.translator.trans('askvortsov-pwa.forum.settings.pwa_notifications.access_denied')]), 10);\n    }\n  });\n  extend('flarum/forum/components/SettingsPage', 'notificationsItems', function (items) {\n    if (!usingAppleWebview()) return;\n    if (!hasFirebasePushState('authorized')) {\n      items.add('firebase-push-optin-default', Alert.component({\n        itemClassName: 'pwa-setting-alert',\n        dismissible: false,\n        controls: [Button.component({\n          className: 'Button Button--link',\n          onclick: () => requestPushPermissions()\n        }, app.translator.trans('askvortsov-pwa.forum.settings.pwa_notifications.access_default_button'))]\n      }, [m(Icon, {\n        name: \"fas fa-exclamation-circle\"\n      }), app.translator.trans('askvortsov-pwa.forum.settings.pwa_notifications.access_default')]), 10);\n    }\n  });\n  extend('flarum/forum/components/SettingsPage', 'oncreate', function () {\n    registerFirebasePushNotificationListeners();\n  });\n  extend('flarum/forum/components/SettingsPage', 'onremove', function () {\n    removeFirebasePushNotificationListeners();\n  });\n};","import { extend } from 'flarum/common/extend';\nimport { openDB } from 'idb';\nimport Page from 'flarum/common/components/Page';\nimport LinkButton from 'flarum/common/components/LinkButton';\nimport SessionDropdown from 'flarum/forum/components/SessionDropdown';\nimport addShareButtons from './addShareButtons';\nimport addPushNotifications, { refreshSubscription } from './addPushNotifications';\napp.initializers.add('askvortsov/flarum-pwa', () => {\n  const isInStandaloneMode = () => window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone || document.referrer.includes('android-app://');\n  extend(Page.prototype, 'oninit', () => {\n    const basePath = app.forum.attribute('basePath').trimRight('/');\n    const registerSW = async () => {\n      const dbPromise = openDB('keyval-store', 1, {\n        upgrade(db) {\n          db.createObjectStore('keyval');\n        }\n      });\n      (await dbPromise).put('keyval', app.forum.data.attributes, 'flarum.forumPayload');\n      if ('serviceWorker' in navigator) {\n        navigator.serviceWorker.register(basePath + '/sw', {\n          scope: basePath + '/'\n        }).then(sw => {\n          navigator.serviceWorker.ready.then(() => {\n            app.sw = sw;\n            refreshSubscription(sw);\n          });\n        });\n      }\n    };\n    registerSW();\n  });\n  extend(SessionDropdown.prototype, 'items', items => {\n    if (isInStandaloneMode() && items.has('administration')) {\n      items.remove('administration');\n      items.add('administration', LinkButton.component({\n        icon: 'fas fa-wrench',\n        href: app.forum.attribute('adminUrl'),\n        target: '_self',\n        external: true\n      }, app.translator.trans('core.forum.header.admin_button')));\n    }\n  });\n  addShareButtons();\n  addPushNotifications();\n});"],"names":["__webpack_require__","module","getter","__esModule","d","a","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","flarum","reg","idbProxyableTypes","cursorAdvanceMethods","cursorRequestMap","WeakMap","transactionDoneMap","transactionStoreNamesMap","transformCache","reverseTransformCache","idbProxyTraps","target","receiver","IDBTransaction","objectStoreNames","undefined","objectStore","wrap","set","value","has","transformCachableValue","func","IDBDatabase","transaction","IDBCursor","advance","continue","continuePrimaryKey","includes","_len2","arguments","length","args","Array","_key2","apply","unwrap","this","_len3","_key3","storeNames","_len","_key","tx","sort","done","Promise","resolve","reject","unlisten","removeEventListener","complete","error","DOMException","addEventListener","cacheDonePromiseForTransaction","object","IDBObjectStore","IDBIndex","some","c","Proxy","IDBRequest","request","promise","success","result","then","catch","promisifyRequest","newValue","readMethods","writeMethods","cachedMethods","Map","getMethod","targetFuncName","replace","useIndex","isWrite","method","async","storeName","store","index","shift","returnVal","oldTraps","shareContent","data","title","navigator","share","url","resultPara","textContent","err","console","log","PushToken","PushPermissionRequest","PushPermissionState","usingAppleWebview","window","webkit","messageHandlers","subscribeUser","save","app","sw","pushManager","subscribe","userVisibleOnly","applicationServerKey","forum","attribute","subscription","body","pushEnabled","session","user","preferences","String","startsWith","endsWith","pushConfigured","registerFirebasePushNotificationListeners","removeFirebasePushNotificationListeners","firebasePushNotificationState","hasFirebasePushState","permissionState","handlePushPermissionRequest","event","detail","postMessage","handlePushToken","token","handlePushPermissionState","m","redraw","state","usePWABuilder","initializers","add","extend","basePath","trimRight","dbPromise","name","version","_temp","blocked","upgrade","blocking","terminated","indexedDB","open","openPromise","oldVersion","newVersion","db","openDB","createObjectStore","put","attributes","serviceWorker","register","scope","ready","cache","pwaRefreshed","Notification","permission","e","getSubscription","s","unsubscribe","bind","refreshSubscription","registerSW","items","matchMedia","matches","standalone","document","referrer","remove","icon","href","external","translator","trans","discussion","onclick","location","protocol","hostname","route","post","username","displayName","dismissAlert","localStorage","setItem","JSON","stringify","timestamp","Date","getTime","alerts","dismiss","pwaNotifsAlert","getItem","show","controls","class","ondismiss","label","itemClassName","dismissible","className","requestPermission","res","type"],"sourceRoot":""}