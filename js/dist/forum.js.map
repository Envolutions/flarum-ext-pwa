{"version":3,"file":"forum.js","mappings":"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E;IACpBX,cAAc,CAACtB,GAAG,CAACiC,KAAK,EAAEqB,QAAQ,CAAC;IACnC/B,qBAAqB,CAACvB,GAAG,CAACsD,QAAQ,EAAErB,KAAK,CAAC;EAC9C;EACA,OAAOqB,QAAQ;AACnB;AACA,MAAM/G,MAAM,GAAI0F,KAAK,IAAKV,qBAAqB,CAAC9C,GAAG,CAACwD,KAAK,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACtLZ;AACK;AACE;AACJ;AACA;AACA;AAC0F;AAC3I;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA,uFAAuF,SAAI;AAC3F;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE,EAAE,+DAAa;AACjB,iEAAe;AACf,EAAE,4DAAM,CAAC,gFAAc;AACvB;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA,qBAAqB,sEAAI;AACzB;AACA;AACA;AACA,SAAS;AACT;AACA,OAAO;AACP;AACA,GAAG;AACH,EAAE,4DAAM;AACR;AACA;AACA;AACA;AACA;AACA,KAAK;AACL,GAAG;AACH,EAAE,4DAAM;AACR,QAAQ,mEAAiB;AACzB;AACA;AACA,2CAA2C,+EAAe;AAC1D;AACA;AACA;AACA;AACA,SAAS;AACT,OAAO,KAAK,sEAAI;AAChB;AACA,OAAO;AACP;AACA;AACA;AACA;AACA,sCAAsC,+EAAe;AACrD;AACA;AACA,mBAAmB,gFAAgB;AACnC;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA,SAAS;AACT,OAAO,KAAK,sEAAI;AAChB;AACA,OAAO;AACP,MAAM;AACN,qCAAqC,+EAAe;AACpD;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT,OAAO,KAAK,sEAAI;AAChB;AACA,OAAO;AACP;AACA,GAAG;AACH,EAAE,4DAAM;AACR,SAAS,mEAAiB;AAC1B;AACA,+CAA+C,+EAAe;AAC9D;AACA;AACA,mBAAmB,gFAAgB;AACnC;AACA,yBAAyB,wEAAsB;AAC/C,SAAS;AACT,OAAO,KAAK,sEAAI;AAChB;AACA,OAAO;AACP;AACA,GAAG;AACH,EAAE,4DAAM;AACR;AACA,GAAG;AACH,EAAE,4DAAM;AACR;AACA,GAAG;AACH,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;ACvJ6C;AACY;AACa;AACZ;AACA;AACN;AACrD;AACA;AACA,kBAAkB,sEAAW;AAC7B;AACA;AACA;AACA,KAAK;AACL;AACA,IAAI;AACJ;AACA;AACA;AACA,iEAAe;AACf,EAAE,4DAAM,CAAC,8EAAkB;AAC3B;AACA,uBAAuB,gFAAgB;AACvC;AACA;AACA;AACA;AACA,OAAO;AACP,KAAK;AACL,GAAG;AACH,EAAE,4DAAM,CAAC,wEAAY;AACrB;AACA,uBAAuB,gFAAgB;AACvC;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA,OAAO;AACP,KAAK;AACL,GAAG;AACH,EAAE,4DAAM,CAAC,wEAAY;AACrB;AACA,uBAAuB,gFAAgB;AACvC;AACA;AACA;AACA;AACA,OAAO;AACP,KAAK;AACL,GAAG;AACH,CAAC;;;;;;;;;;;;;;;;;;;;;;;ACpD6C;AACjB;AACoB;AACY;AACS;AACtB;AACmC;AACnF;AACA;AACA,EAAE,4DAAM,CAAC,gFAAc;AACvB;AACA;AACA,wBAAwB,2CAAM;AAC9B;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,YAAY,0EAAmB;AAC/B,WAAW;AACX,SAAS;AACT;AACA;AACA;AACA,GAAG;AACH,EAAE,4DAAM,CAAC,0FAAyB;AAClC;AACA;AACA,kCAAkC,oFAAoB;AACtD;AACA;AACA;AACA;AACA,OAAO;AACP;AACA,GAAG;AACH,EAAE,4DAAe;AACjB,EAAE,iEAAoB;AACtB,CAAC;;;;;;;;;;;;;;;;;;;;;;AC5CD;AACA;AACA;AACO;;AAEP;AACA;AACA;AACO;;AAEP;AACA;AACA;AACO;;AAEP;AACA;AACA,aAAa;AACb;AACO;AACA;AACA;AACA;AACA;AACP;AACA,YAAY;AACZ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;;AAEA;AACA,aAAa,iGAAiG;AAC9G;AACA,eAAe;AACf;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;AC7EA;;;;;;;;;;;ACAA;;;;;;;;;;;ACAA;;;;;;;;;;;ACAA;;;;;;;;;;;ACAA;;;;;;;;;;;ACAA;;;;;;;;;;;ACAA;;;;;;;;;;;ACAA;;;;;;;;;;;ACAA;;;;;;;;;;;ACAA;;;;;;;;;;;ACAA;;;;;;;;;;;ACAA;;;;;;UCAA;UACA;;UAEA;UACA;UACA,wEAAwE;UACxE;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;;UAEA;UACA;;UAEA;UACA;UACA;;;;;WCtBA;WACA;WACA;WACA;WACA;WACA,iCAAiC,WAAW;WAC5C;WACA;;;;;WCPA;WACA;WACA;WACA;WACA,yCAAyC,wCAAwC;WACjF;WACA;WACA;;;;;WCPA;;;;;WCAA;WACA;WACA;WACA,uDAAuD,iBAAiB;WACxE;WACA,gDAAgD,aAAa;WAC7D","sources":["webpack://@askvortsov/flarum-pwa/./node_modules/idb/build/esm/index.js","webpack://@askvortsov/flarum-pwa/./node_modules/idb/build/esm/wrap-idb-value.js","webpack://@askvortsov/flarum-pwa/./src/forum/addPushNotifications.js","webpack://@askvortsov/flarum-pwa/./src/forum/addShareButtons.js","webpack://@askvortsov/flarum-pwa/./src/forum/index.js","webpack://@askvortsov/flarum-pwa/./src/forum/use-pwa-builder.js","webpack://@askvortsov/flarum-pwa/external root \"flarum.reg.get('core', 'common/components/Alert')\"","webpack://@askvortsov/flarum-pwa/external root \"flarum.reg.get('core', 'common/components/Button')\"","webpack://@askvortsov/flarum-pwa/external root \"flarum.reg.get('core', 'common/components/Icon')\"","webpack://@askvortsov/flarum-pwa/external root \"flarum.reg.get('core', 'common/components/Link')\"","webpack://@askvortsov/flarum-pwa/external root \"flarum.reg.get('core', 'common/components/LinkButton')\"","webpack://@askvortsov/flarum-pwa/external root \"flarum.reg.get('core', 'common/components/Page')\"","webpack://@askvortsov/flarum-pwa/external root \"flarum.reg.get('core', 'common/extend')\"","webpack://@askvortsov/flarum-pwa/external root \"flarum.reg.get('core', 'common/utils/extractText')\"","webpack://@askvortsov/flarum-pwa/external root \"flarum.reg.get('core', 'forum/components/SessionDropdown')\"","webpack://@askvortsov/flarum-pwa/external root \"flarum.reg.get('core', 'forum/utils/DiscussionControls')\"","webpack://@askvortsov/flarum-pwa/external root \"flarum.reg.get('core', 'forum/utils/PostControls')\"","webpack://@askvortsov/flarum-pwa/external root \"flarum.reg.get('core', 'forum/utils/UserControls')\"","webpack://@askvortsov/flarum-pwa/webpack/bootstrap","webpack://@askvortsov/flarum-pwa/webpack/runtime/compat get default export","webpack://@askvortsov/flarum-pwa/webpack/runtime/define property getters","webpack://@askvortsov/flarum-pwa/webpack/runtime/hasOwnProperty shorthand","webpack://@askvortsov/flarum-pwa/webpack/runtime/make namespace object"],"sourcesContent":["import { w as wrap, r as replaceTraps } from './wrap-idb-value.js';\nexport { u as unwrap, w as wrap } from './wrap-idb-value.js';\n\n/**\n * Open a database.\n *\n * @param name Name of the database.\n * @param version Schema version.\n * @param callbacks Additional callbacks.\n */\nfunction openDB(name, version, { blocked, upgrade, blocking, terminated } = {}) {\n    const request = indexedDB.open(name, version);\n    const openPromise = wrap(request);\n    if (upgrade) {\n        request.addEventListener('upgradeneeded', (event) => {\n            upgrade(wrap(request.result), event.oldVersion, event.newVersion, wrap(request.transaction));\n        });\n    }\n    if (blocked)\n        request.addEventListener('blocked', () => blocked());\n    openPromise\n        .then((db) => {\n        if (terminated)\n            db.addEventListener('close', () => terminated());\n        if (blocking)\n            db.addEventListener('versionchange', () => blocking());\n    })\n        .catch(() => { });\n    return openPromise;\n}\n/**\n * Delete a database.\n *\n * @param name Name of the database.\n */\nfunction deleteDB(name, { blocked } = {}) {\n    const request = indexedDB.deleteDatabase(name);\n    if (blocked)\n        request.addEventListener('blocked', () => blocked());\n    return wrap(request).then(() => undefined);\n}\n\nconst readMethods = ['get', 'getKey', 'getAll', 'getAllKeys', 'count'];\nconst writeMethods = ['put', 'add', 'delete', 'clear'];\nconst cachedMethods = new Map();\nfunction getMethod(target, prop) {\n    if (!(target instanceof IDBDatabase &&\n        !(prop in target) &&\n        typeof prop === 'string')) {\n        return;\n    }\n    if (cachedMethods.get(prop))\n        return cachedMethods.get(prop);\n    const targetFuncName = prop.replace(/FromIndex$/, '');\n    const useIndex = prop !== targetFuncName;\n    const isWrite = writeMethods.includes(targetFuncName);\n    if (\n    // Bail if the target doesn't exist on the target. Eg, getAll isn't in Edge.\n    !(targetFuncName in (useIndex ? IDBIndex : IDBObjectStore).prototype) ||\n        !(isWrite || readMethods.includes(targetFuncName))) {\n        return;\n    }\n    const method = async function (storeName, ...args) {\n        // isWrite ? 'readwrite' : undefined gzipps better, but fails in Edge :(\n        const tx = this.transaction(storeName, isWrite ? 'readwrite' : 'readonly');\n        let target = tx.store;\n        if (useIndex)\n            target = target.index(args.shift());\n        const returnVal = await target[targetFuncName](...args);\n        if (isWrite)\n            await tx.done;\n        return returnVal;\n    };\n    cachedMethods.set(prop, method);\n    return method;\n}\nreplaceTraps((oldTraps) => ({\n    ...oldTraps,\n    get: (target, prop, receiver) => getMethod(target, prop) || oldTraps.get(target, prop, receiver),\n    has: (target, prop) => !!getMethod(target, prop) || oldTraps.has(target, prop),\n}));\n\nexport { deleteDB, openDB };\n","const instanceOfAny = (object, constructors) => constructors.some((c) => object instanceof c);\n\nlet idbProxyableTypes;\nlet cursorAdvanceMethods;\n// This is a function to prevent it throwing up in node environments.\nfunction getIdbProxyableTypes() {\n    return (idbProxyableTypes ||\n        (idbProxyableTypes = [\n            IDBDatabase,\n            IDBObjectStore,\n            IDBIndex,\n            IDBCursor,\n            IDBTransaction,\n        ]));\n}\n// This is a function to prevent it throwing up in node environments.\nfunction getCursorAdvanceMethods() {\n    return (cursorAdvanceMethods ||\n        (cursorAdvanceMethods = [\n            IDBCursor.prototype.advance,\n            IDBCursor.prototype.continue,\n            IDBCursor.prototype.continuePrimaryKey,\n        ]));\n}\nconst cursorRequestMap = new WeakMap();\nconst transactionDoneMap = new WeakMap();\nconst transactionStoreNamesMap = new WeakMap();\nconst transformCache = new WeakMap();\nconst reverseTransformCache = new WeakMap();\nfunction promisifyRequest(request) {\n    const promise = new Promise((resolve, reject) => {\n        const unlisten = () => {\n            request.removeEventListener('success', success);\n            request.removeEventListener('error', error);\n        };\n        const success = () => {\n            resolve(wrap(request.result));\n            unlisten();\n        };\n        const error = () => {\n            reject(request.error);\n            unlisten();\n        };\n        request.addEventListener('success', success);\n        request.addEventListener('error', error);\n    });\n    promise\n        .then((value) => {\n        // Since cursoring reuses the IDBRequest (*sigh*), we cache it for later retrieval\n        // (see wrapFunction).\n        if (value instanceof IDBCursor) {\n            cursorRequestMap.set(value, request);\n        }\n        // Catching to avoid \"Uncaught Promise exceptions\"\n    })\n        .catch(() => { });\n    // This mapping exists in reverseTransformCache but doesn't doesn't exist in transformCache. This\n    // is because we create many promises from a single IDBRequest.\n    reverseTransformCache.set(promise, request);\n    return promise;\n}\nfunction cacheDonePromiseForTransaction(tx) {\n    // Early bail if we've already created a done promise for this transaction.\n    if (transactionDoneMap.has(tx))\n        return;\n    const done = new Promise((resolve, reject) => {\n        const unlisten = () => {\n            tx.removeEventListener('complete', complete);\n            tx.removeEventListener('error', error);\n            tx.removeEventListener('abort', error);\n        };\n        const complete = () => {\n            resolve();\n            unlisten();\n        };\n        const error = () => {\n            reject(tx.error || new DOMException('AbortError', 'AbortError'));\n            unlisten();\n        };\n        tx.addEventListener('complete', complete);\n        tx.addEventListener('error', error);\n        tx.addEventListener('abort', error);\n    });\n    // Cache it for later retrieval.\n    transactionDoneMap.set(tx, done);\n}\nlet idbProxyTraps = {\n    get(target, prop, receiver) {\n        if (target instanceof IDBTransaction) {\n            // Special handling for transaction.done.\n            if (prop === 'done')\n                return transactionDoneMap.get(target);\n            // Polyfill for objectStoreNames because of Edge.\n            if (prop === 'objectStoreNames') {\n                return target.objectStoreNames || transactionStoreNamesMap.get(target);\n            }\n            // Make tx.store return the only store in the transaction, or undefined if there are many.\n            if (prop === 'store') {\n                return receiver.objectStoreNames[1]\n                    ? undefined\n                    : receiver.objectStore(receiver.objectStoreNames[0]);\n            }\n        }\n        // Else transform whatever we get back.\n        return wrap(target[prop]);\n    },\n    set(target, prop, value) {\n        target[prop] = value;\n        return true;\n    },\n    has(target, prop) {\n        if (target instanceof IDBTransaction &&\n            (prop === 'done' || prop === 'store')) {\n            return true;\n        }\n        return prop in target;\n    },\n};\nfunction replaceTraps(callback) {\n    idbProxyTraps = callback(idbProxyTraps);\n}\nfunction wrapFunction(func) {\n    // Due to expected object equality (which is enforced by the caching in `wrap`), we\n    // only create one new func per func.\n    // Edge doesn't support objectStoreNames (booo), so we polyfill it here.\n    if (func === IDBDatabase.prototype.transaction &&\n        !('objectStoreNames' in IDBTransaction.prototype)) {\n        return function (storeNames, ...args) {\n            const tx = func.call(unwrap(this), storeNames, ...args);\n            transactionStoreNamesMap.set(tx, storeNames.sort ? storeNames.sort() : [storeNames]);\n            return wrap(tx);\n        };\n    }\n    // Cursor methods are special, as the behaviour is a little more different to standard IDB. In\n    // IDB, you advance the cursor and wait for a new 'success' on the IDBRequest that gave you the\n    // cursor. It's kinda like a promise that can resolve with many values. That doesn't make sense\n    // with real promises, so each advance methods returns a new promise for the cursor object, or\n    // undefined if the end of the cursor has been reached.\n    if (getCursorAdvanceMethods().includes(func)) {\n        return function (...args) {\n            // Calling the original function with the proxy as 'this' causes ILLEGAL INVOCATION, so we use\n            // the original object.\n            func.apply(unwrap(this), args);\n            return wrap(cursorRequestMap.get(this));\n        };\n    }\n    return function (...args) {\n        // Calling the original function with the proxy as 'this' causes ILLEGAL INVOCATION, so we use\n        // the original object.\n        return wrap(func.apply(unwrap(this), args));\n    };\n}\nfunction transformCachableValue(value) {\n    if (typeof value === 'function')\n        return wrapFunction(value);\n    // This doesn't return, it just creates a 'done' promise for the transaction,\n    // which is later returned for transaction.done (see idbObjectHandler).\n    if (value instanceof IDBTransaction)\n        cacheDonePromiseForTransaction(value);\n    if (instanceOfAny(value, getIdbProxyableTypes()))\n        return new Proxy(value, idbProxyTraps);\n    // Return the same value back if we're not going to transform it.\n    return value;\n}\nfunction wrap(value) {\n    // We sometimes generate multiple promises from a single IDBRequest (eg when cursoring), because\n    // IDB is weird and a single IDBRequest can yield many responses, so these can't be cached.\n    if (value instanceof IDBRequest)\n        return promisifyRequest(value);\n    // If we've already transformed this value before, reuse the transformed value.\n    // This is faster, but it also provides object equality.\n    if (transformCache.has(value))\n        return transformCache.get(value);\n    const newValue = transformCachableValue(value);\n    // Not all types are transformed.\n    // These may be primitive types, so they can't be WeakMap keys.\n    if (newValue !== value) {\n        transformCache.set(value, newValue);\n        reverseTransformCache.set(newValue, value);\n    }\n    return newValue;\n}\nconst unwrap = (value) => reverseTransformCache.get(value);\n\nexport { reverseTransformCache as a, instanceOfAny as i, replaceTraps as r, unwrap as u, wrap as w };\n","import { extend } from 'flarum/common/extend';\nimport Alert from 'flarum/common/components/Alert';\nimport Button from 'flarum/common/components/Button';\nimport Link from 'flarum/common/components/Link';\nimport Page from 'flarum/common/components/Page';\nimport Icon from 'flarum/common/components/Icon';\nimport { usingAppleWebview, requestPushPermissions, requestPushPermissionState, requestPushToken, usePWABuilder } from './use-pwa-builder';\nconst subscribeUser = save => {\n  return app.sw.pushManager.subscribe({\n    userVisibleOnly: true,\n    applicationServerKey: app.forum.attribute('vapidPublicKey')\n  }).then(subscription => {\n    if (!save) return;\n    app.request({\n      method: 'POST',\n      url: app.forum.attribute('apiUrl') + '/pwa/push',\n      body: {\n        subscription\n      }\n    });\n  });\n};\nconst pushEnabled = () => {\n  if (!app.session.user) return false;\n  const obj = app.session.user.preferences();\n  let key;\n  for (key in obj) {\n    if ((typeof key === 'string' || key instanceof String) && key.startsWith('notify_') && key.endsWith('_push') && obj[key]) {\n      return true;\n    }\n  }\n  return false;\n};\nconst supportsBrowserNotifications = () => 'Notification' in window;\nexport const refreshSubscription = async sw => {\n  if (!app.cache.pwaRefreshed && 'Notification' in window && window.Notification.permission === 'granted' && pushEnabled()) try {\n    await subscribeUser(true);\n  } catch (e) {\n    if (!sw.pushManager) {\n      return;\n    }\n    sw.pushManager.getSubscription().then(s => s.unsubscribe().then(subscribeUser.bind(this, true)));\n  }\n  app.cache.pwaRefreshed = true;\n};\nconst pushConfigured = () => {\n  return app.forum.attribute('vapidPublicKey');\n};\nlet {\n  registerFirebasePushNotificationListeners,\n  removeFirebasePushNotificationListeners,\n  firebasePushNotificationState,\n  hasFirebasePushState\n} = usePWABuilder();\nexport default () => {\n  extend(Page.prototype, 'oncreate', () => {\n    if (!pushConfigured()) return;\n    const dismissAlert = () => {\n      localStorage.setItem('askvortov-pwa.notif-alert.dismissed', JSON.stringify({\n        timestamp: new Date().getTime()\n      }));\n    };\n    app.alerts.dismiss(app.cache.pwaNotifsAlert);\n    if (!localStorage.getItem('askvortov-pwa.notif-alert.dismissed') && 'Notification' in window && window.Notification.permission === 'default' && pushEnabled()) {\n      app.cache.pwaNotifsAlert = app.alerts.show({\n        controls: [m(Link, {\n          class: \"Button Button--link\",\n          href: app.route('settings'),\n          onclick: () => dismissAlert()\n        }, app.translator.trans('askvortsov-pwa.forum.alerts.optin_button'))],\n        ondismiss: dismissAlert\n      }, app.translator.trans('askvortsov-pwa.forum.alerts.optin'));\n    }\n  });\n  extend('flarum/forum/components/NotificationGrid', 'notificationMethods', function (items) {\n    if (!pushConfigured()) return;\n    items.add('push', {\n      name: 'push',\n      icon: 'fas fa-mobile',\n      label: app.translator.trans('askvortsov-pwa.forum.settings.push_header')\n    });\n  });\n  extend('flarum/forum/components/SettingsPage', 'notificationsItems', function (items) {\n    if (usingAppleWebview()) return;\n    if (!pushConfigured()) return;\n    if (!supportsBrowserNotifications()) {\n      items.add('push-no-browser-support', Alert.component({\n        dismissible: false,\n        controls: [m(\"a\", {\n          class: \"Button Button--link\",\n          href: \"https://developer.mozilla.org/en-US/docs/Web/API/Push_API\"\n        }, app.translator.trans('askvortsov-pwa.forum.settings.pwa_notifications.no_browser_support_button'))]\n      }, [m(Icon, {\n        name: \"fas fa-exclamation-triangle\"\n      }), app.translator.trans('askvortsov-pwa.forum.settings.pwa_notifications.no_browser_support')]), 10);\n      return;\n    }\n    if (window.Notification.permission === 'default') {\n      if (!pushConfigured()) return;\n      items.add('push-optin-default', Alert.component({\n        itemClassName: 'pwa-setting-alert',\n        dismissible: false,\n        controls: [Button.component({\n          className: 'Button Button--link',\n          onclick: () => {\n            window.Notification.requestPermission(res => {\n              m.redraw();\n              if (res === 'granted') {\n                subscribeUser(true);\n              }\n            });\n          }\n        }, app.translator.trans('askvortsov-pwa.forum.settings.pwa_notifications.access_default_button'))]\n      }, [m(Icon, {\n        name: \"fas fa-exclamation-circle\"\n      }), app.translator.trans('askvortsov-pwa.forum.settings.pwa_notifications.access_default')]), 10);\n    } else if (window.Notification.permission === 'denied') {\n      items.add('push-optin-denied', Alert.component({\n        itemClassName: 'pwa-setting-alert',\n        dismissible: false,\n        type: 'error',\n        controls: [m(\"a\", {\n          class: \"Button Button--link\",\n          href: \"https://support.humblebundle.com/hc/en-us/articles/360008513933-Enabling-and-Disabling-Browser-Notifications-in-Various-Browsers\"\n        }, app.translator.trans('askvortsov-pwa.forum.settings.pwa_notifications.access_denied_button'))]\n      }, [m(Icon, {\n        name: \"fas fa-exclamation-triangle\"\n      }), app.translator.trans('askvortsov-pwa.forum.settings.pwa_notifications.access_denied')]), 10);\n    }\n  });\n  extend('flarum/forum/components/SettingsPage', 'notificationsItems', function (items) {\n    if (!usingAppleWebview()) return;\n    if (!hasFirebasePushState('authorized')) {\n      items.add('firebase-push-optin-default', Alert.component({\n        itemClassName: 'pwa-setting-alert',\n        dismissible: false,\n        controls: [Button.component({\n          className: 'Button Button--link',\n          onclick: () => requestPushPermissions()\n        }, app.translator.trans('askvortsov-pwa.forum.settings.pwa_notifications.access_default_button'))]\n      }, [m(Icon, {\n        name: \"fas fa-exclamation-circle\"\n      }), app.translator.trans('askvortsov-pwa.forum.settings.pwa_notifications.access_default')]), 10);\n    }\n  });\n  extend('flarum/forum/components/SettingsPage', 'oncreate', function () {\n    registerFirebasePushNotificationListeners();\n  });\n  extend('flarum/forum/components/SettingsPage', 'onremove', function () {\n    removeFirebasePushNotificationListeners();\n  });\n};","import { extend } from 'flarum/common/extend';\nimport extractText from 'flarum/common/utils/extractText';\nimport DiscussionControls from 'flarum/forum/utils/DiscussionControls';\nimport PostControls from 'flarum/forum/utils/PostControls';\nimport UserControls from 'flarum/forum/utils/UserControls';\nimport Button from 'flarum/common/components/Button';\nasync function shareContent(data) {\n  try {\n    const title = extractText(data.title);\n    await navigator.share({\n      title,\n      url: data.url\n    });\n    resultPara.textContent = 'MDN shared successfully';\n  } catch (err) {\n    console.log('Error: ' + err);\n  }\n}\nexport default () => {\n  extend(DiscussionControls, 'userControls', function (items, discussion) {\n    if (!navigator.share) return;\n    items.add('share', Button.component({\n      icon: 'fas fa-share-square',\n      onclick: () => shareContent({\n        title: discussion.title(),\n        url: window.location.protocol + '//' + window.location.hostname + app.route.discussion(discussion)\n      })\n    }, app.translator.trans('askvortsov-pwa.forum.discussion_controls.share_button')), -1);\n  });\n  extend(PostControls, 'userControls', function (items, post) {\n    if (!navigator.share) return;\n    items.add('share', Button.component({\n      icon: 'fas fa-share-square',\n      onclick: () => shareContent({\n        title: app.translator.trans('askvortsov-pwa.forum.post_controls.share_api.title', {\n          username: post.user().displayName(),\n          title: post.discussion().title()\n        }),\n        url: window.location.protocol + '//' + window.location.hostname + app.route.post(post)\n      })\n    }, app.translator.trans('askvortsov-pwa.forum.post_controls.share_button')), 100);\n  });\n  extend(UserControls, 'userControls', function (items, user) {\n    if (!navigator.share) return;\n    items.add('share', Button.component({\n      icon: 'fas fa-share-square',\n      onclick: () => shareContent({\n        title: user.displayName(),\n        url: window.location.protocol + '//' + window.location.hostname + app.route.user(user)\n      })\n    }, app.translator.trans('askvortsov-pwa.forum.user_controls.share_button')), 100);\n  });\n};","import { extend } from 'flarum/common/extend';\nimport { openDB } from 'idb';\nimport Page from 'flarum/common/components/Page';\nimport LinkButton from 'flarum/common/components/LinkButton';\nimport SessionDropdown from 'flarum/forum/components/SessionDropdown';\nimport addShareButtons from './addShareButtons';\nimport addPushNotifications, { refreshSubscription } from './addPushNotifications';\napp.initializers.add('askvortsov/flarum-pwa', () => {\n  const isInStandaloneMode = () => window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone || document.referrer.includes('android-app://');\n  extend(Page.prototype, 'oninit', () => {\n    const basePath = app.forum.attribute('basePath').trimRight('/');\n    const registerSW = async () => {\n      const dbPromise = openDB('keyval-store', 1, {\n        upgrade(db) {\n          db.createObjectStore('keyval');\n        }\n      });\n      (await dbPromise).put('keyval', app.forum.data.attributes, 'flarum.forumPayload');\n      if ('serviceWorker' in navigator) {\n        navigator.serviceWorker.register(basePath + '/sw', {\n          scope: basePath + '/'\n        }).then(sw => {\n          navigator.serviceWorker.ready.then(() => {\n            app.sw = sw;\n            refreshSubscription(sw);\n          });\n        });\n      }\n    };\n    registerSW();\n  });\n  extend(SessionDropdown.prototype, 'items', items => {\n    if (isInStandaloneMode() && items.has('administration')) {\n      items.remove('administration');\n      items.add('administration', LinkButton.component({\n        icon: 'fas fa-wrench',\n        href: app.forum.attribute('adminUrl'),\n        target: '_self',\n        external: true\n      }, app.translator.trans('core.forum.header.admin_button')));\n    }\n  });\n  addShareButtons();\n  addPushNotifications();\n});","/**\n * Triggered when the push token is generated by the device.\n */\nexport const PushToken = 'push-token';\n\n/**\n * Triggered when the user requests permission on the push event.\n */\nexport const PushPermissionRequest = 'push-permission-request';\n\n/**\n * Returns the state of the push request of the device.\n */\nexport const PushPermissionState = 'push-permission-state';\n\n/**\n * Check if the client is a webview in an iOS or iPadOS device.\n * @returns {boolean}\n */\nexport const usingAppleWebview = () => window.webkit && window.webkit.messageHandlers;\nexport const requestPushPermissionState = () => window.webkit.messageHandlers[PushPermissionState].postMessage(PushPermissionState);\nexport const requestPushPermissions = () => window.webkit.messageHandlers[PushPermissionRequest].postMessage(PushPermissionRequest);\nexport const requestPushToken = () => window.webkit.messageHandlers[PushToken].postMessage(PushToken);\nexport const usePWABuilder = () => {\n  /**\n   * @type {'notDetermined' | 'denied' | 'authorized' | 'ephemeral' | 'provisional' | 'unknown' | 'granted'}\n   */\n  let permissionState = 'granted';\n  const handlePushPermissionRequest = event => {\n    if (event.detail !== 'granted') {\n      return;\n    }\n    permissionState = 'granted';\n    requestPushToken();\n  };\n  const handlePushToken = event => {\n    app.request({\n      method: 'POST',\n      url: app.forum.attribute('apiUrl') + '/pwa/firebase-push-subscriptions',\n      body: {\n        token: event.detail\n      }\n    });\n  };\n  const handlePushPermissionState = event => {\n    permissionState = event.detail;\n    m.redraw();\n  };\n\n  /**\n   * @param {'notDetermined' | 'denied' | 'authorized' | 'ephemeral' | 'provisional' | 'unknown' | 'granted'} state\n   *\n   * @returns {boolean}\n   */\n  const hasFirebasePushState = state => state === permissionState;\n  function registerFirebasePushNotificationListeners() {\n    if (!usingAppleWebview()) {\n      return;\n    }\n    requestPushPermissionState();\n    window.addEventListener(PushPermissionRequest, handlePushPermissionRequest);\n    window.addEventListener(PushPermissionState, handlePushPermissionState);\n    window.addEventListener(PushToken, handlePushToken);\n  }\n  function removeFirebasePushNotificationListeners() {\n    if (!usingAppleWebview()) {\n      return;\n    }\n    window.removeEventListener(PushPermissionRequest, handlePushPermissionRequest);\n    window.removeEventListener(PushPermissionState, handlePushPermissionState);\n    window.removeEventListener(PushToken, handlePushToken);\n  }\n  return {\n    hasFirebasePushState,\n    registerFirebasePushNotificationListeners,\n    removeFirebasePushNotificationListeners\n  };\n};","module.exports = flarum.reg.get('core', 'common/components/Alert');","module.exports = flarum.reg.get('core', 'common/components/Button');","module.exports = flarum.reg.get('core', 'common/components/Icon');","module.exports = flarum.reg.get('core', 'common/components/Link');","module.exports = flarum.reg.get('core', 'common/components/LinkButton');","module.exports = flarum.reg.get('core', 'common/components/Page');","module.exports = flarum.reg.get('core', 'common/extend');","module.exports = flarum.reg.get('core', 'common/utils/extractText');","module.exports = flarum.reg.get('core', 'forum/components/SessionDropdown');","module.exports = flarum.reg.get('core', 'forum/utils/DiscussionControls');","module.exports = flarum.reg.get('core', 'forum/utils/PostControls');","module.exports = flarum.reg.get('core', 'forum/utils/UserControls');","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\tflarum.reg._webpack_runtimes[\"askvortsov-pwa\"] ||= __webpack_require__;// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};"],"names":["w","wrap","r","replaceTraps","u","unwrap","openDB","name","version","_temp","blocked","upgrade","blocking","terminated","request","indexedDB","open","openPromise","addEventListener","event","result","oldVersion","newVersion","transaction","then","db","catch","deleteDB","_temp2","deleteDatabase","undefined","readMethods","writeMethods","cachedMethods","Map","getMethod","target","prop","IDBDatabase","get","targetFuncName","replace","useIndex","isWrite","includes","IDBIndex","IDBObjectStore","prototype","method","storeName","tx","store","_len","arguments","length","args","Array","_key","index","shift","returnVal","done","set","oldTraps","receiver","has","instanceOfAny","object","constructors","some","c","idbProxyableTypes","cursorAdvanceMethods","getIdbProxyableTypes","IDBCursor","IDBTransaction","getCursorAdvanceMethods","advance","continue","continuePrimaryKey","cursorRequestMap","WeakMap","transactionDoneMap","transactionStoreNamesMap","transformCache","reverseTransformCache","promisifyRequest","promise","Promise","resolve","reject","unlisten","removeEventListener","success","error","value","cacheDonePromiseForTransaction","complete","DOMException","idbProxyTraps","objectStoreNames","objectStore","callback","wrapFunction","func","storeNames","call","sort","_len2","_key2","apply","_len3","_key3","transformCachableValue","Proxy","IDBRequest","newValue","a","i"],"sourceRoot":""}