{"version":3,"file":"admin.js","mappings":";;;;;;;;;;;;;;;;;;;AAAqD;AACqB;AAC3D,kCAAkC,kFAAiB;AAClE;AACA;AACA,6BAA6B,WAAW,GAAG,WAAW;AACtD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA,OAAO;AACP,MAAM;AACN;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;AC/BkE;AACf;AACE;AACoB;AACjB;AACgB;AACzD,sBAAsB,8EAAa;AAClD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA,OAAO,IAAI,kFAAgB;AAC3B;AACA;AACA;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA,KAAK,kIAAkI,uEAAK;AAC5I;AACA;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,KAAK;AACL,8BAA8B,wEAAM;AACpC;AACA;AACA,OAAO;AACP;AACA,OAAO;AACP,KAAK;AACL;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA;AACA;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA,SAAS;AACT,OAAO;AACP;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA;AACA,OAAO,IAAI,4DAAmB;AAC9B;AACA,OAAO;AACP;AACA,OAAO;AACP;AACA,OAAO;AACP,KAAK,OAAO,oEAA2B;AACvC;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA,SAAS;AACT;AACA,SAAS;AACT,OAAO;AACP;AACA;AACA;AACA,6BAA6B,EAAE,UAAU,EAAE;AAC3C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;ACxKgD;AACjC,0CAA0C,gEAAS;AAClE;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA,OAAO;AACP,KAAK;AACL;AACA;AACA;;;;;;;;;;;;;ACvC2C;AAC3C;AACA,uDAAuD,2DAAO;AAC9D,CAAC;;;;;;;;;;;ACHD;;;;;;;;;;;ACAA;;;;;;;;;;;ACAA;;;;;;;;;;;ACAA;;;;;;;;;;;ACAA;;;;;;;;;;;ACAA;;;;;;UCAA;UACA;;UAEA;UACA;UACA,wEAAwE;UACxE;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;;UAEA;UACA;;UAEA;UACA;UACA;;;;;WCtBA;WACA;WACA;WACA;WACA;WACA,iCAAiC,WAAW;WAC5C;WACA;;;;;WCPA;WACA;WACA;WACA;WACA,yCAAyC,wCAAwC;WACjF;WACA;WACA;;;;;WCPA;;;;;WCAA;WACA;WACA;WACA,uDAAuD,iBAAiB;WACxE;WACA,gDAAgD,aAAa;WAC7D","sources":["webpack://@askvortsov/flarum-pwa/./src/admin/components/PWALogoUploadButton.js","webpack://@askvortsov/flarum-pwa/./src/admin/components/PWAPage.js","webpack://@askvortsov/flarum-pwa/./src/admin/components/PWAUploadFirebaseConfigForm.js","webpack://@askvortsov/flarum-pwa/./src/admin/index.js","webpack://@askvortsov/flarum-pwa/external root \"flarum.reg.get('core', 'admin/components/ExtensionPage')\"","webpack://@askvortsov/flarum-pwa/external root \"flarum.reg.get('core', 'admin/components/UploadImageButton')\"","webpack://@askvortsov/flarum-pwa/external root \"flarum.reg.get('core', 'common/Component')\"","webpack://@askvortsov/flarum-pwa/external root \"flarum.reg.get('core', 'common/components/Alert')\"","webpack://@askvortsov/flarum-pwa/external root \"flarum.reg.get('core', 'common/components/Button')\"","webpack://@askvortsov/flarum-pwa/external root \"flarum.reg.get('core', 'common/components/LoadingIndicator')\"","webpack://@askvortsov/flarum-pwa/webpack/bootstrap","webpack://@askvortsov/flarum-pwa/webpack/runtime/compat get default export","webpack://@askvortsov/flarum-pwa/webpack/runtime/define property getters","webpack://@askvortsov/flarum-pwa/webpack/runtime/hasOwnProperty shorthand","webpack://@askvortsov/flarum-pwa/webpack/runtime/make namespace object"],"sourcesContent":["import Button from 'flarum/common/components/Button';\nimport UploadImageButton from 'flarum/admin/components/UploadImageButton';\nexport default class PWALogoUploadButton extends UploadImageButton {\n  static initAttrs(attrs) {\n    super.initAttrs(attrs);\n    attrs.name = `pwa-icon-${attrs.size}x${attrs.size}`;\n  }\n  view(vnode) {\n    this.attrs.loading = this.loading;\n    this.attrs.className = (this.attrs.className || '') + ' Button';\n    if (app.data.settings['askvortsov-pwa.icon_' + this.attrs.size + '_path']) {\n      this.attrs.onclick = this.remove.bind(this);\n      return m(\"div\", null, m(\"p\", null, m(\"img\", {\n        src: app.forum.attribute(this.attrs.name + 'Url'),\n        alt: \"\"\n      })), m(\"p\", null, super.view({\n        ...vnode,\n        children: app.translator.trans('core.admin.upload_image.remove_button')\n      })));\n    } else {\n      this.attrs.onclick = this.upload.bind(this);\n    }\n    return super.view({\n      ...vnode,\n      children: app.translator.trans('core.admin.upload_image.upload_button')\n    });\n  }\n  resourceUrl() {\n    return app.forum.attribute('apiUrl') + '/pwa/logo/' + this.attrs.size;\n  }\n}\nflarum.reg.add('askvortsov-pwa', 'admin/components/PWALogoUploadButton', PWALogoUploadButton);","import ExtensionPage from 'flarum/admin/components/ExtensionPage';\nimport Alert from 'flarum/common/components/Alert';\nimport Button from 'flarum/common/components/Button';\nimport LoadingIndicator from 'flarum/common/components/LoadingIndicator';\nimport PWALogoUploadButton from './PWALogoUploadButton';\nimport PWAUploadFirebaseConfigForm from './PWAUploadFirebaseConfigForm';\nexport default class PWAPage extends ExtensionPage {\n  oninit(vnode) {\n    super.oninit(vnode);\n    this.saving = false;\n    this.refresh();\n  }\n  refresh() {\n    this.loading = true;\n    this.status_messages = [];\n    this.manifest = {};\n    this.sizes = [];\n    app.request({\n      method: 'GET',\n      url: app.forum.attribute('apiUrl') + '/pwa/settings'\n    }).then(response => {\n      this.manifest = response['data']['attributes']['manifest'];\n      this.sizes = response['data']['attributes']['sizes'];\n      this.status_messages = response['data']['attributes']['status_messages'];\n      this.loading = false;\n      m.redraw();\n    });\n  }\n  checkExistence(url) {\n    let http = new XMLHttpRequest();\n    http.open('HEAD', url, false);\n    http.send();\n    return http.status != 404;\n  }\n  content() {\n    if (this.loading || this.saving) {\n      return m(\"div\", {\n        className: \"PWAPage\"\n      }, m(\"div\", {\n        className: \"container\"\n      }, m(LoadingIndicator, null)));\n    }\n    return m(\"div\", {\n      className: \"PWAPage\"\n    }, m(\"div\", {\n      className: \"container\"\n    }, m(\"form\", null, m(\"h2\", null, app.translator.trans('askvortsov-pwa.admin.pwa.heading')), m(\"div\", {\n      className: \"helpText\"\n    }, app.translator.trans('askvortsov-pwa.admin.pwa.text')), m(\"div\", {\n      class: \"statusCheck\"\n    }, m(\"legend\", null, app.translator.trans('askvortsov-pwa.admin.pwa.status_check_heading')), this.status_messages.map(message => m(Alert, {\n      type: message.type,\n      dismissible: false\n    }, [message.message]))), m(\"fieldset\", {\n      class: \"parent\"\n    }, m(\"legend\", null, app.translator.trans('askvortsov-pwa.admin.pwa.maintenance.heading')), this.buildSettingComponent({\n      setting: 'askvortsov-pwa.debug',\n      label: app.translator.trans('askvortsov-pwa.admin.pwa.maintenance.debug_label'),\n      help: app.translator.trans('askvortsov-pwa.admin.pwa.maintenance.debug_text'),\n      type: 'boolean'\n    }), this.buildSettingComponent(() => {\n      return m(\"div\", null, m(Button, {\n        className: \"Button\",\n        onclick: this.resetVapid.bind(this)\n      }, \"Reset VAPID keys\"), m(\"div\", {\n        className: \"helpText\"\n      }, app.translator.trans('askvortsov-pwa.admin.pwa.maintenance.reset_vapid_text')));\n    })), m(\"fieldset\", {\n      class: \"parent\"\n    }, m(\"fieldset\", null, m(\"legend\", null, app.translator.trans('askvortsov-pwa.admin.pwa.about.heading')), this.buildSettingComponent({\n      setting: 'askvortsov-pwa.shortName',\n      placeholder: this.setting('forum_title')(),\n      label: app.translator.trans('askvortsov-pwa.admin.pwa.about.short_name_label'),\n      help: app.translator.trans('askvortsov-pwa.admin.pwa.about.short_name_text'),\n      type: 'text'\n    })), m(\"fieldset\", null, this.buildSettingComponent({\n      setting: 'askvortsov-pwa.longName',\n      placeholder: this.setting('forum_title')(),\n      label: app.translator.trans('askvortsov-pwa.admin.pwa.about.long_name_label'),\n      help: app.translator.trans('askvortsov-pwa.admin.pwa.about.long_name_text'),\n      type: 'text'\n    })), m(\"fieldset\", null, m(\"div\", {\n      className: \"helpText\"\n    }, app.translator.trans('askvortsov-pwa.admin.pwa.about.description_text')), m(\"textarea\", {\n      className: \"FormControl\",\n      value: this.manifest.description,\n      disabled: true\n    }, this.manifest.description))), m(\"fieldset\", {\n      class: \"parent\"\n    }, m(\"fieldset\", null, m(\"legend\", null, app.translator.trans('askvortsov-pwa.admin.pwa.colors.heading')), this.buildSettingComponent({\n      setting: 'askvortsov-pwa.themeColor',\n      placeholder: this.setting('theme_primary_color')(),\n      label: app.translator.trans('askvortsov-pwa.admin.pwa.colors.theme_color_label'),\n      help: app.translator.trans('askvortsov-pwa.admin.pwa.colors.theme_color_text'),\n      type: 'color-preview'\n    })), m(\"fieldset\", null, this.buildSettingComponent({\n      setting: 'askvortsov-pwa.backgroundColor',\n      label: app.translator.trans('askvortsov-pwa.admin.pwa.colors.background_color_label'),\n      help: app.translator.trans('askvortsov-pwa.admin.pwa.colors.background_color_text'),\n      type: 'color-preview'\n    }))), m(\"fieldset\", {\n      class: \"parent\"\n    }, m(\"fieldset\", null, m(\"legend\", null, app.translator.trans('askvortsov-pwa.admin.pwa.other.heading')), this.buildSettingComponent({\n      setting: 'askvortsov-pwa.forcePortrait',\n      label: app.translator.trans('askvortsov-pwa.admin.pwa.other.force_portrait_text'),\n      type: 'boolean'\n    })), m(\"fieldset\", null, this.buildSettingComponent({\n      setting: 'askvortsov-pwa.userMaxSubscriptions',\n      label: app.translator.trans('askvortsov-pwa.admin.pwa.other.user_max_subscriptions_label'),\n      help: app.translator.trans('askvortsov-pwa.admin.pwa.other.user_max_subscriptions_text'),\n      type: 'number',\n      placeholder: 20\n    })), m(\"fieldset\", null, this.buildSettingComponent({\n      setting: 'askvortsov-pwa.pushNotifPreferenceDefaultToEmail',\n      label: app.translator.trans('askvortsov-pwa.admin.pwa.other.push_notif_preference_default_to_email_label'),\n      help: app.translator.trans('askvortsov-pwa.admin.pwa.other.push_notif_preference_default_to_email_text'),\n      type: 'bool'\n    })), m(\"fieldset\", null, this.buildSettingComponent({\n      setting: 'askvortsov-pwa.windowControlsOverlay',\n      label: app.translator.trans('askvortsov-pwa.admin.pwa.other.window_controls_overlay_label'),\n      help: app.translator.trans('askvortsov-pwa.admin.pwa.other.window_controls_overlay_text', {\n        compatibilitylink: m(\"a\", {\n          href: \"https://caniuse.com/mdn-api_windowcontrolsoverlay\",\n          tabindex: \"-1\"\n        }),\n        learnlink: m(\"a\", {\n          href: \"https://learn.microsoft.com/en-us/microsoft-edge/progressive-web-apps-chromium/how-to/window-controls-overlay\",\n          tabindex: \"-1\"\n        })\n      }),\n      type: 'bool'\n    }))), this.submitButton(), m(\"fieldset\", null, m(\"legend\", null, app.translator.trans('askvortsov-pwa.admin.pwa.logo_heading')), m(\"div\", {\n      className: \"helpText\"\n    }, app.translator.trans('askvortsov-pwa.admin.pwa.logo_text')), this.sizes.map(size => {\n      return m(\"fieldset\", {\n        class: \"logoFieldset\"\n      }, m(PWALogoUploadButton, {\n        size: size\n      }), m(\"div\", {\n        className: \"helpText\"\n      }, app.translator.trans('askvortsov-pwa.admin.pwa.logo_size_text', {\n        size\n      })));\n    }))), m(PWAUploadFirebaseConfigForm, null)));\n  }\n  resetVapid() {\n    if (confirm(app.translator.trans('askvortsov-pwa.admin.pwa.maintenance.reset_vapid_confirm'))) {\n      app.request({\n        method: 'POST',\n        url: app.forum.attribute('apiUrl') + '/reset_vapid'\n      }).then(response => {\n        app.alerts.show({\n          type: 'success'\n        }, app.translator.trans('askvortsov-pwa.admin.pwa.maintenance.reset_vapid_success', {\n          count: response.deleted\n        }));\n      });\n    }\n  }\n  saveSettings(e) {\n    const hex = /^(#[0-9a-f]{3}([0-9a-f]{3})?)?$/i;\n    if (!hex.test(this.setting('askvortsov-pwa.backgroundColor')())) {\n      alert(app.translator.trans('core.admin.appearance.enter_hex_message'));\n      return;\n    }\n    return super.saveSettings(e);\n  }\n}\nflarum.reg.add('askvortsov-pwa', 'admin/components/PWAPage', PWAPage);","import Component from 'flarum/common/Component';\nexport default class PWAUploadFirebaseConfigForm extends Component {\n  view(vnode) {\n    return m('[', null, m(\"form\", {\n      action: \"/pwa/firebase-config\",\n      method: \"POST\",\n      onsubmit: this.updateFirebaseConfig.bind(this)\n    }, m(\"fieldset\", null, m(\"fieldset\", null, m(\"legend\", null, app.translator.trans('askvortsov-pwa.admin.pwa.firebase_config.heading')), m(\"div\", {\n      className: \"helpText\"\n    }, m(\"span\", null, app.translator.trans('askvortsov-pwa.admin.pwa.firebase_config.help_text')), m(\"a\", {\n      href: \"https://docs.pwabuilder.com/#/builder/app-store?id=push-notifications\",\n      target: \"_blank\"\n    }, app.translator.trans('askvortsov-pwa.admin.pwa.firebase_config.see_documentation_here'))), m(\"button\", {\n      type: \"button\",\n      className: \"Button\",\n      onclick: () => document.querySelector('#flarum-pwa-upload-button').click()\n    }, app.translator.trans('askvortsov-pwa.admin.pwa.firebase_config.upload_file')), m(\"input\", {\n      id: \"flarum-pwa-upload-button\",\n      type: \"file\",\n      onchange: this.updateFirebaseConfig.bind(this),\n      style: {\n        opacity: 0\n      }\n    })))));\n  }\n  updateFirebaseConfig(event) {\n    const body = new FormData();\n    body.append('file', event.target.files[0]);\n    app.request({\n      method: 'POST',\n      url: app.forum.attribute('apiUrl') + '/pwa/firebase-config',\n      body: body\n    }).then(response => {\n      app.alerts.show({\n        type: 'success'\n      }, app.translator.trans('askvortsov-pwa.admin.pwa.firebase_config.upload_successful'));\n    });\n  }\n}\nflarum.reg.add('askvortsov-pwa', 'admin/components/PWAUploadFirebaseConfigForm', PWAUploadFirebaseConfigForm);","import PWAPage from './components/PWAPage';\napp.initializers.add('askvortsov/flarum-pwa', () => {\n  app.extensionData.for('askvortsov-pwa').registerPage(PWAPage);\n});","module.exports = flarum.reg.get('core', 'admin/components/ExtensionPage');","module.exports = flarum.reg.get('core', 'admin/components/UploadImageButton');","module.exports = flarum.reg.get('core', 'common/Component');","module.exports = flarum.reg.get('core', 'common/components/Alert');","module.exports = flarum.reg.get('core', 'common/components/Button');","module.exports = flarum.reg.get('core', 'common/components/LoadingIndicator');","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\tflarum.reg._webpack_runtimes[\"askvortsov-pwa\"] ||= __webpack_require__;// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};"],"names":[],"sourceRoot":""}
