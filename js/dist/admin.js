(()=>{var t={n:a=>{var e=a&&a.__esModule?()=>a.default:()=>a;return t.d(e,{a:e}),e},d:(a,e)=>{for(var s in e)t.o(e,s)&&!t.o(a,s)&&Object.defineProperty(a,s,{enumerable:!0,get:e[s]})},o:(t,a)=>Object.prototype.hasOwnProperty.call(t,a)};(()=>{"use strict";const a=flarum.reg.get("core","admin/components/ExtensionPage");var e=t.n(a);const s=flarum.reg.get("core","common/components/Alert");var o=t.n(s);const r=flarum.reg.get("core","common/components/Button");var n=t.n(r);const i=flarum.reg.get("core","common/components/LoadingIndicator");var l=t.n(i);const p=flarum.reg.get("core","common/components/UploadImageButton");var d=t.n(p);class u extends(d()){static initAttrs(t){super.initAttrs(t),t.name=`pwa-icon-${t.size}x${t.size}`}view(t){return this.attrs.loading=this.loading,this.attrs.className=(this.attrs.className||"")+" Button",app.data.settings["askvortsov-pwa.icon_"+this.attrs.size+"_path"]?(this.attrs.onclick=this.remove.bind(this),this.attrs.value=app.data.settings["askvortsov-pwa.icon_"+this.attrs.size+"_path"],this.attrs.url=app.forum.attribute(this.attrs.name+"Url")):this.attrs.onclick=this.upload.bind(this),super.view({...t,children:app.translator.trans("core.admin.upload_image.upload_buttonx")})}remove(){this.loading=!0,m.redraw(),app.request({method:"DELETE",url:this.deleteUrl()}).then(this.success.bind(this),this.failure.bind(this))}deleteUrl(){return app.forum.attribute("apiUrl")+"/pwa-settings/logo/"+this.attrs.size}resourceUrl(){return app.forum.attribute("apiUrl")+"/pwa/logo/"+this.attrs.size}}flarum.reg.add("askvortsov-pwa","admin/components/PWALogoUploadButton",u);const c=flarum.reg.get("core","common/Component");var v=t.n(c);class h extends(v()){view(t){return m("[",null,m("form",{action:"/pwa/firebase-config",method:"POST",onsubmit:this.updateFirebaseConfig.bind(this)},m("fieldset",null,m("fieldset",null,m("legend",null,app.translator.trans("askvortsov-pwa.admin.pwa.firebase_config.heading")),m("div",{className:"helpText"},m("span",null,app.translator.trans("askvortsov-pwa.admin.pwa.firebase_config.help_text")),m("a",{href:"https://docs.pwabuilder.com/#/builder/app-store?id=push-notifications",target:"_blank"},app.translator.trans("askvortsov-pwa.admin.pwa.firebase_config.see_documentation_here"))),m("button",{type:"button",className:"Button",onclick:()=>document.querySelector("#flarum-pwa-upload-button").click()},app.translator.trans("askvortsov-pwa.admin.pwa.firebase_config.upload_file")),m("input",{id:"flarum-pwa-upload-button",type:"file",onchange:this.updateFirebaseConfig.bind(this),style:{opacity:0}})))))}updateFirebaseConfig(t){const a=new FormData;a.append("file",t.target.files[0]),app.request({method:"POST",url:app.forum.attribute("apiUrl")+"/pwa-settings/firebase-config",body:a}).then((t=>{app.alerts.show({type:"success"},app.translator.trans("askvortsov-pwa.admin.pwa.firebase_config.upload_successful"))}))}}flarum.reg.add("askvortsov-pwa","admin/components/PWAUploadFirebaseConfigForm",h);class w extends(e()){oninit(t){super.oninit(t),this.saving=!1,this.refresh()}refresh(){this.loading=!0,this.status_messages=[],this.manifest={},this.sizes=[],app.request({method:"GET",url:app.forum.attribute("apiUrl")+"/pwa-settings"}).then((t=>{this.manifest=t.data.attributes.manifest,this.sizes=t.data.attributes.sizes,this.status_messages=t.data.attributes.status_messages,this.loading=!1,m.redraw()}))}checkExistence(t){let a=new XMLHttpRequest;return a.open("HEAD",t,!1),a.send(),404!=a.status}content(){return this.loading||this.saving?m("div",{className:"PWAPage"},m("div",{className:"container"},m(l(),null))):m("div",{className:"PWAPage"},m("div",{className:"container"},m("form",null,m("h2",null,app.translator.trans("askvortsov-pwa.admin.pwa.heading")),m("div",{className:"helpText"},app.translator.trans("askvortsov-pwa.admin.pwa.text")),m("div",{class:"statusCheck"},m("legend",null,app.translator.trans("askvortsov-pwa.admin.pwa.status_check_heading")),this.status_messages.map((t=>m(o(),{type:t.type,dismissible:!1},[t.message])))),m("fieldset",{class:"parent"},m("legend",null,app.translator.trans("askvortsov-pwa.admin.pwa.maintenance.heading")),this.buildSettingComponent({setting:"askvortsov-pwa.debug",label:app.translator.trans("askvortsov-pwa.admin.pwa.maintenance.debug_label"),help:app.translator.trans("askvortsov-pwa.admin.pwa.maintenance.debug_text"),type:"boolean"}),this.buildSettingComponent((()=>m("div",null,m(n(),{className:"Button",onclick:this.resetVapid.bind(this)},"Reset VAPID keys"),m("div",{className:"helpText"},app.translator.trans("askvortsov-pwa.admin.pwa.maintenance.reset_vapid_text")))))),m("fieldset",{class:"parent"},m("fieldset",null,m("legend",null,app.translator.trans("askvortsov-pwa.admin.pwa.about.heading")),this.buildSettingComponent({setting:"askvortsov-pwa.shortName",placeholder:this.setting("forum_title")(),label:app.translator.trans("askvortsov-pwa.admin.pwa.about.short_name_label"),help:app.translator.trans("askvortsov-pwa.admin.pwa.about.short_name_text"),type:"text"})),m("fieldset",null,this.buildSettingComponent({setting:"askvortsov-pwa.longName",placeholder:this.setting("forum_title")(),label:app.translator.trans("askvortsov-pwa.admin.pwa.about.long_name_label"),help:app.translator.trans("askvortsov-pwa.admin.pwa.about.long_name_text"),type:"text"})),m("fieldset",null,m("div",{className:"helpText"},app.translator.trans("askvortsov-pwa.admin.pwa.about.description_text")),m("textarea",{className:"FormControl",value:this.manifest.description,disabled:!0},this.manifest.description))),m("fieldset",{class:"parent"},m("fieldset",null,m("legend",null,app.translator.trans("askvortsov-pwa.admin.pwa.colors.heading")),this.buildSettingComponent({setting:"askvortsov-pwa.themeColor",placeholder:this.setting("theme_primary_color")(),label:app.translator.trans("askvortsov-pwa.admin.pwa.colors.theme_color_label"),help:app.translator.trans("askvortsov-pwa.admin.pwa.colors.theme_color_text"),type:"color-preview"})),m("fieldset",null,this.buildSettingComponent({setting:"askvortsov-pwa.backgroundColor",label:app.translator.trans("askvortsov-pwa.admin.pwa.colors.background_color_label"),help:app.translator.trans("askvortsov-pwa.admin.pwa.colors.background_color_text"),type:"color-preview"}))),m("fieldset",{class:"parent"},m("fieldset",null,m("legend",null,app.translator.trans("askvortsov-pwa.admin.pwa.other.heading")),this.buildSettingComponent({setting:"askvortsov-pwa.forcePortrait",label:app.translator.trans("askvortsov-pwa.admin.pwa.other.force_portrait_text"),type:"boolean"})),m("fieldset",null,this.buildSettingComponent({setting:"askvortsov-pwa.userMaxSubscriptions",label:app.translator.trans("askvortsov-pwa.admin.pwa.other.user_max_subscriptions_label"),help:app.translator.trans("askvortsov-pwa.admin.pwa.other.user_max_subscriptions_text"),type:"number",placeholder:20})),m("fieldset",null,this.buildSettingComponent({setting:"askvortsov-pwa.pushNotifPreferenceDefaultToEmail",label:app.translator.trans("askvortsov-pwa.admin.pwa.other.push_notif_preference_default_to_email_label"),help:app.translator.trans("askvortsov-pwa.admin.pwa.other.push_notif_preference_default_to_email_text"),type:"bool"})),m("fieldset",null,this.buildSettingComponent({setting:"askvortsov-pwa.windowControlsOverlay",label:app.translator.trans("askvortsov-pwa.admin.pwa.other.window_controls_overlay_label"),help:app.translator.trans("askvortsov-pwa.admin.pwa.other.window_controls_overlay_text",{compatibilitylink:m("a",{href:"https://caniuse.com/mdn-api_windowcontrolsoverlay",tabindex:"-1"}),learnlink:m("a",{href:"https://learn.microsoft.com/en-us/microsoft-edge/progressive-web-apps-chromium/how-to/window-controls-overlay",tabindex:"-1"})}),type:"bool"}))),this.submitButton(),m("fieldset",null,m("legend",null,app.translator.trans("askvortsov-pwa.admin.pwa.logo_heading")),m("div",{className:"helpText"},app.translator.trans("askvortsov-pwa.admin.pwa.logo_text")),this.sizes.map((t=>m("fieldset",{class:"logoFieldset"},m(u,{size:t}),m("div",{className:"helpText"},app.translator.trans("askvortsov-pwa.admin.pwa.logo_size_text",{size:t}))))))),m(h,null)))}resetVapid(){confirm(app.translator.trans("askvortsov-pwa.admin.pwa.maintenance.reset_vapid_confirm"))&&app.request({method:"POST",url:app.forum.attribute("apiUrl")+"/pwa-settings/reset_vapid"}).then((t=>{app.alerts.show({type:"success"},app.translator.trans("askvortsov-pwa.admin.pwa.maintenance.reset_vapid_success",{count:t.deleted}))}))}saveSettings(t){if(/^(#[0-9a-f]{3}([0-9a-f]{3})?)?$/i.test(this.setting("askvortsov-pwa.backgroundColor")()))return super.saveSettings(t);alert(app.translator.trans("core.admin.appearance.enter_hex_message"))}}flarum.reg.add("askvortsov-pwa","admin/components/PWAPage",w),app.initializers.add("askvortsov/flarum-pwa",(()=>{app.registry.for("askvortsov-pwa").registerPage(w)}))})(),module.exports={}})();
//# sourceMappingURL=admin.js.map